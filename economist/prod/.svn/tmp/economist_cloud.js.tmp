(function() { var style = document.createElement('style'), css_str = '#infomous-cloudContainer{font-family:Arial,sans-serif;margin:0;position:relative}#infomous-movie-container{line-height:0}#infomous-cloudSections{font-size:13px;height:30px;margin-bottom:0;border-bottom:5px solid #598a9e}#infomous-cloudSections a.section{color:#26526f;background-color:#d3d3d3;display:block;float:left;height:25px;width:135px;text-decoration:none;padding:5px 8px 0 8px;position:relative;margin-right:10px}#infomous-cloudSections a.section span{position:relative;top:4px;left:2px;font-weight:bold}#infomous-cloudSections a.section:hover{color:white}#infomous-cloudSections a.active{color:white;background-color:#598a9e}#infomous-cloudFooter{height:25px;background-color:#598a9e;font-size:11px;margin:0}#infomous-cloudFooter a.footer-elem{display:block;text-decoration:none;padding:3px 16px 0 10px;color:#598a9e}#infomous-cloudFooter a.footer-elem:hover{color:#c0dbe5}#infomous-cloudFooter a#cloud-full-bt{float:left}#infomous-cloudFooter a#cloud-period-bt{float:right}#infomous-cloudFooter a.footer-elem span{position:relative;top:-4px;left:3px;color:white}#infomous-cloudPeriodBar{position:absolute;color:white;z-index:2;-webkit-border-radius:5px;border-radius:5px;right:16px;bottom:32px;background-color:#000;background-color:rgba(0,0,0,0.7);font-size:12px;height:25px;margin-bottom:0}#infomous-cloudPeriodBar .svg-triangle{fill:#000;fill:rgba(0,0,0,0.7);position:absolute;left:250px;top:25px;width:12px;height:10px}#infomous-cloudPeriodBar .period{padding:5px 10px 0 15px;float:left}#infomous-cloudPeriodBar a.date{color:inherit;display:block;float:left;height:25px;text-decoration:none}#infomous-cloudPeriodBar img{display:block;float:left;cursor:pointer;margin-left:10px;margin-right:10px;margin-top:4px}#infomous-cloudPeriodBar a.date span{position:relative;top:5px;border-left:1px solid #CCC;padding:0 5px}#infomous-cloudPeriodBar a.date:hover{background-color:#000;background-color:rgba(0,0,0,0.2)}#infomous-cloudPeriodBar a.activeDate{font-weight:bold}#infomous-cloudPeriodBar a.last{border-right:1px solid #CCC}.infomous .infomous-cloud .sources .menu-sources-list .menu-source-item .line1 font,.infomous .infomous-cloud .sources .menu-sources-list .menu-source-item .line1 font *{font-size:12px;display:inline}.infomous .infomous-cloud .sources .menu-sources-list .menu-source-item .line1 font font,.infomous .infomous-cloud .sources .menu-sources-list .menu-source-item .line2 font{color:#999}'; document.getElementsByTagName('head')[0].appendChild(style); if (style.styleSheet) style.styleSheet.cssText = css_str; else style.appendChild( document.createTextNode( css_str ) ); })();
document.write('<div id="infomous-cloudContainer"><div id="infomous-cloudSections"><!--<a class="section"id="electionism"href="javascript:void(0);"><span>Election 2012 tweets</span></a>--><!--<a class="section active"id="readerscomments"href="javascript:void(0);"><span>Readers\'</span><span> comments</span></a>--></div><div id="infomous-cloudPeriodBar"style="display:none;"><span class="period">Period:</span><a class="date activeDate"id="daysback_1"href="javascript:void(0);"><span>1 day</span></a><a class="date"id="daysback_7"href="javascript:void(0);"><span>1 week</span></a><a class="date"id="daysback_14"href="javascript:void(0);"><span>2 weeks</span></a><a class="date"id="daysback_30"href="javascript:void(0);"><span>30 days</span></a><img src="http://economist.infomous.com/site/economist/1_6b/img/cross.png"class="period-close-icon"alt="Toggle Period Bar"height="15"width="15"/><svg xmlns="http://www.w3.org/2000/svg"version="1.1"class="svg-triangle"><polygon points="0,0 12,0 6,10"/></svg></div><div id="infomous-movie-container"><div id="infomous"class="infomous"></div></div><div id="infomous-cloudFooter"><a class="footer-elem"id="cloud-full-bt"style="display:none;"href="#"target="_blank"><img src="http://economist.infomous.com/site/economist/1_6b/img/cloud-full-icon.png"class="cloud-full-icon"/><span>Full version</span></a><a class="footer-elem"id="cloud-period-bt"href="javascript:void(0);"><img src="http://economist.infomous.com/site/economist/1_6b/img/cloud-period-icon.png"class="cloud-period-icon"/><span>Change time span</span></a></div></div>');
<<<<<<< .mine
(function(l){var r={version:"prod"};var j={ec_tabs:"davos,readerscomments",loadAtStart:false,setInterfaceType:"widget",setFrame:false,"query:campaign":"noAds","query:cAuthors":true,"query:cFeed":false,"query:cFeedLink":"none",adsPosition:"bottom",skin:"economist",linkageThreshold:1,setPanels:"words,blobs,status,branding",setShowReset:true,setShowErrors:false,brandLogoPosition:"top left",title:"The Economist Opinion Cloud",description:"",groups:1,fontScale:1,zoom:1,dict:"NOUN|1,VERB|0,ADJECTIVE|0,ADVERB|0,NUMBER|0,OTHER|1",setMinutesToReload:15,trackOmniture:false,trackGoogle:true,trackGAAccount:"UA-20995290-1"};var q={};q.get_script_urls=function(x){var k=document.getElementsByTagName("script"),w,z;var y=[];for(var v=0;v<k.length;v++){w=k[v];z=w.getAttribute?w.getAttribute("src"):w.src;if(z&&x.test(z)){y.push(z)}}return y};q.get_url_params=function(w,v){if(v===undefined&&typeof w==="string"&&w.length===1){v=w;w=undefined}w=w||q.href();v=v||"?";var z=w.split(v);if(z.length==1){return{}}z=z[1];var k=z.split("&"),x=k.length,A={};while(x--){if(q.is_empty(k[x])){continue}var y=k[x].split("=");A[y[0]]=y[1]}return A};q.href=function(){var k;try{k=window.top.location.href}catch(v){}return k||document.referrer};q.is_empty=function(v){if(v===null||v===undefined){return true}if(typeof v==="string"){return v.replace(/\s/g,"")===""}for(var k in v){if(v.hasOwnProperty(k)){return false}}return true};q.esc=function(x){if(Object.prototype.toString.call(x)==="[object Object]"){for(var w in x){x[w]=v(x[w])}}else{return v(x)}function v(k){if(!Object.prototype.toString.call(k)=="[object String]"){return k}return k.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}};function f(v,x){var k=document.createElement("script");k.type="text/javascript";k.async=true;k.src=v;var w=document.getElementsByTagName("script")[0];w.parentNode.insertBefore(k,w);if(k.addEventListener){k.addEventListener("load",x,false)}else{k.attachEvent("onreadystatechange",readyHandler=function(){if(/complete|loaded/.test(k.readyState)){x();k.detachEvent("onreadystatechange",readyHandler)}})}}var i,d,p,u,g;l.infomous_load=function(k,v){i=Infomous;i.require("jquery",function(){d=i.$;p=new i.CloudProxy(k,v,"economist_proxy");u=new i.GAtracker({name:"infomous_economist",account:v.trackGAAccount});g=parseInt(v.width);o()})};var s=q.get_script_urls(/economist_cloud\.js/)[0];var c=(function(){var v=/dev3\.infomous\.com/.test(q.href())?"dev3":"economist";var k="http://"+v+".infomous.com/site/economist/"+r.version+"/";return{embedjs:k+"client/embed.js?"}})();var b=q.get_url_params(s);var e=q.get_url_params();q.esc(b);q.esc(e);for(var m in j){b[m]=j[m]}window.params={allowFullScreen:true,allowScriptAccess:"always",wmode:"opaque",bgcolor:"#D9E4E6"};f(c.embedjs+a(b),function(){});function a(x){var w="";for(var v in x){w+=v+"="+x[v]+"&"}return w}function n(){var v="/conversation-cloud";var w=window.location.href;if(/economist\.com/.test(w)){return v}var k=w.split("/");if(!/\./.test(k[k.length-1])){return w+v}return k.slice(0,-1).join("/")+v}function h(){return g>450}function t(k,w){var v=b.brandLogoDestination;k=v!==undefined?decodeURIComponent(v):k;p.set_var("brandLogoDestination",k);p.set_var("brandLogoText",w)}function o(){var I=(function(){var M=undefined;var L={readerscomments:{ga_event:"Readerscomments",title:"Readers' comments",update:function(N){t("http://www.infomous.com/site/economist","Powered by Infomous and Appinions");p.set_var("type","jodange");p.set_vars(this.colors);p.set_vars({agg:undefined,sinceLast:undefined,feeds:"undefined"});p.set_vars({fromDaysBack:N,toDaysBack:0,"query:numOpinions":"2500","query:licensee":"jodange","query:campaign":"noAds","query:blocked":"Polish,Russian,American,European,Libyan,French,Indian,Chinese,German,Turkish,Japanese,British,Nepali,Canadian"});p.make_request()},colors:{colWord:"0x000000",colWordHover:"0xFFFFFF",colWordFade:"0x333333",colWordHoverLinked:"0x000000",colBackground:"0xD9E4E6",colHoverBox:"0x08526D",colFocusBox:"0xFFFFFF",colFocusBorder:"0x08526D",colBlob:"0xFFFFFF",colBlobHover:"0x96AFAE",colBlobBorder:"0x86A1A8",colLink:"0x86A1A8",colLinkHover:"0xFF0000",colSourcesFill:"0xFFFFFF",colSourcesLine1:"0x08526D",colSourcesLine2:"0x08526D",colSourcesTextHover:"0x488CA7",colSourcesBorder:"0x488CA7"}},electionism:{ga_event:"Election2012",title:"Election 2012 tweets",update:function(N){t("http://www.infomous.com/site/economist/electionism.html","Powered by Infomous");p.set_var("type","rss");p.set_vars(this.colors);p.set_vars({fromDaysBack:undefined,toDaysBack:undefined});p.set_vars({agg:"yes",sinceLast:N+"d","query:num":"2500","query:campaign":"electionism",feeds:"http://api.twitter.com/1/lists/statuses.atom?slug=latest-from-twitter&owner_screen_name=Electionism&per_page=100&include_entities=true&infcutbef=:%20"});p.make_request()},colors:{colBackground:"0xD9E4E6",colHoverBox:"0xBF0A30",colFocusBox:"0xFFFFFF",colSourcesFill:"0xFFFFFF",colSourcesLine1:"0x08526D",colSourcesLine2:"0x08526D",colSourcesTextHover:"0x488CA7",colSourcesBorder:"0x488CA7",colWordHighlighted:"0x005BED",colWord:"0x002868",colWordHover:"0xFFFFFF",colWordFade:"0xFFB0B0",colWordHoverLinked:"0x005BED",colFocusBorder:"0x005BED",colLink:"0xFFE0E0",colLinkHover:"0xDEF1FF",colBlob:"0xFFFFFF",colBlobBorder:"0xBF0A30",colBlobHover:"0xAAAAAA"}},davos:{ga_event:"Davos2013",title:"Davos Tweets",update:function(N){t("http://www.infomous.com/site/economist","Powered by Infomous");p.set_var("type","rss");p.set_vars(this.colors);p.set_vars({fromDaysBack:undefined,toDaysBack:undefined});p.set_vars({agg:"yes",sinceLast:N+"d","query:num":"2500","query:campaign":"davos",feeds:"http://api.twitter.com/1/lists/statuses.atom?slug=davos&owner_screen_name=InfomousLists&per_page=100&include_entities=true"});p.make_request()},colors:{colBackground:"0xD9E4E6",colHoverBox:"0xBF0A30",colFocusBox:"0xFFFFFF",colSourcesFill:"0xFFFFFF",colSourcesLine1:"0x08526D",colSourcesLine2:"0x08526D",colSourcesTextHover:"0x488CA7",colSourcesBorder:"0x488CA7",colWordHighlighted:"0x005BED",colWord:"0x002868",colWordHover:"0xFFFFFF",colWordFade:"0xFFB0B0",colWordHoverLinked:"0x005BED",colFocusBorder:"0x005BED",colLink:"0xFFE0E0",colLinkHover:"0xDEF1FF",colBlob:"0xFFFFFF",colBlobBorder:"0xBF0A30",colBlobHover:"0xAAAAAA"}}};return{has:function(N){return L[N]!==undefined},curr:function(N){if(N===undefined){return L[M]}M=N},curr_id:function(){return M},make_el:function(N){if(!I.has(N)){return undefined}return d('<a id="'+N+'" href="javascript:void(0);"><span>'+L[N].title+"</span></a>")}}})();var K=d("#infomous-cloudContainer");var v=d("#infomous-cloudSections");var J=d("#infomous-cloudPeriodBar");var D=d("#cloud-period-bt");var H=d("#cloud-full-bt");var k=J.find(".date");var B=F(y(x()),v);B.click(function(){E(d(this).attr("id"));u.track_event({action:"menu_tab",label:I.curr().ga_event})});k.click(function(){z(d(this).attr("id"))});K.css("width",i.css.size(g));J.hide();D.click(G);J.find("img").click(G);w();E(A());function F(L,O){var N,P,M;for(N=0;N<L.length;N++){P=L[N];M=I.make_el(P);if(!M){continue}M.addClass("section");if(N===0){M.addClass("active")}O.append(M)}return O.find(".section")}function G(){if(J.is(":visible")){J.fadeOut(400,w)}else{J.fadeIn(400,w)}}function w(){}function C(){if(h()){H.hide();return}var M=I.curr_id();var L=n();H.click(function(){d(this).attr("href",L+"?days=1&ec_ini_tab="+M+"&ec_tabs="+x())});H.show()}function E(N){if(!I.has(N)){return}var M=d("#"+N);if(!M.length){return}I.curr(N);B.removeClass("active");M.addClass("active");var L=1;I.curr().update(L);C();k.removeClass("activeDate");J.find("#daysback_"+L).addClass("activeDate");u.track_page()}function z(N){var L=d("#"+N);if(!L.length){return}var M=parseInt(N.split("_").pop());I.curr().update(M);C();k.removeClass("activeDate");L.addClass("activeDate")}function A(){var O="ec_ini_tab";var M=[].concat(y(e[O])).concat(y(b[O])).concat(y(x()));for(var N=0;N<M.length;N++){if(L(M[N])){return M[N]}}return undefined;function L(P){return !i.is_empty(P)&&I.has(P)}}function x(){var N="ec_tabs";var L=[e[N],b[N],"davos,electionism,readerscomments"];for(var M=0;M<L.length;M++){if(L[M]){return L[M]}}return undefined}function y(L){return i.is_str(L)?L.split(","):[]}}})(window);=======

(function(root) {

var config = { 
    version: 'prod' //TODO update this to 'davos' when available
}

var _vars_ec = {

    ec_tabs: 'davos,readerscomments', //TODO put this in config

    loadAtStart: false,
    setInterfaceType: 'widget',
    setFrame: false,

    'query:campaign': 'noAds',

    'query:cAuthors': true,
    'query:cFeed': false,
    'query:cFeedLink': 'none',

    adsPosition: 'bottom',
    skin: 'economist',

    linkageThreshold: 1,
    setPanels: 'words,blobs,status,branding',
    setShowReset: true,
    setShowErrors: false,
    brandLogoPosition: 'top left',
    title: 'The Economist Opinion Cloud', 
    description: '',
    groups: 1,
    fontScale: 1,
    zoom: 1,
    dict: 'NOUN|1,VERB|0,ADJECTIVE|0,ADVERB|0,NUMBER|0,OTHER|1',
    setMinutesToReload: 15,

    trackOmniture: false,
    trackGoogle: true,
    trackGAAccount: 'UA-20995290-1'
};

/*
 * Infomous sdk utils copy
 */

var _I = {};

_I.get_script_urls = function(re) {
    var scripts = document.getElementsByTagName('script'),
        el, src; 
    var urls = [];
    for (var i = 0; i < scripts.length; i++) {
        el = scripts[i];
        src = el.getAttribute ? el.getAttribute('src') : el.src;
        if (src && re.test(src)) 
            urls.push( src );
    }	
    return urls;
}

_I.get_url_params = function(url, sep) {
    if (sep === undefined && typeof url === 'string' && url.length === 1) {
        sep = url;
        url = undefined;
    }
    url = url || _I.href(); 
    sep = sep || '?';
    var query = url.split(sep);
    if (query.length == 1)
        return {};
    query = query[1];
    var args = query.split('&'),
        i = args.length,
        params = {};
    while (i--) {
        if ( _I.is_empty( args[i] ) )
            continue;
        var kv = args[i].split('=');
        params[ kv[0] ] = kv[1]; 
    }
    return params;
}

_I.href = function() {
    var url;
    try { url = window.top.location.href; }
    catch (err) { }
    return url || document.referrer;
}

_I.is_empty = function(obj) {
    
    if (obj === null || obj === undefined) 
        return true;
    
    if ( typeof obj === 'string' ) return obj.replace(/\s/g,'') === ''; 
    //if ( I.is_array(obj) ) return obj.length === 0;
    //if ( I.is_str(obj) ) return obj.replace(/\s/g,'') === ''; 
    //if ( I.is_num(obj) ) return false;

    for (var key in obj) 
        if (obj.hasOwnProperty(key)) 
            return false;
    
    return true;
}

_I.esc = function(data) {
    if ( Object.prototype.toString.call(data) === "[object Object]" ) {
        for (var k in data) 
            data[k] = _esc(data[k]);
    }
    else return _esc(data);

    function _esc(d) {
        if ( ! Object.prototype.toString.call(d) == "[object String]" ) return d;
        return d.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
}

function load_js_file(url, on_complete) {
    //console.log('load_js_file', url, on_complete);
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.async = true;
    script.src = url;
    var entry = document.getElementsByTagName('script')[0];
    entry.parentNode.insertBefore(script, entry);
    if (script.addEventListener)
        script.addEventListener('load', on_complete, false);
    else {
        script.attachEvent('onreadystatechange',
                readyHandler = function() {
                    if (/complete|loaded/.test(
                            script.readyState)) {
                        on_complete();
                        script.detachEvent(
                            'onreadystatechange',
                            readyHandler);
                    }
                });
    }	
}

/* end of Infomous sdk utils copy */

/*
 * economist app
 */

var I, $, proxy, ga, cloud_width;

root.infomous_load = function(platform, vars) {

    I = Infomous;

    I.require('jquery', function() {

        $ = I.$;

        proxy = new I.CloudProxy(
            platform, vars, 'economist_proxy');

        ga = new I.GAtracker({
            name: 'infomous_economist', 
            account: vars.trackGAAccount
        });

        cloud_width = parseInt(vars.width);

        init();
    });
}

/*
 * embed.js snippet
 * always after infomous_load global definition
 */

var _ec_tag = _I.get_script_urls(/economist_cloud\.js/)[0];
var _ec_path = (function() {
    var server = /dev3\.infomous\.com/.test( _I.href() ) ? 'dev3' : 'economist';
    var base = 'http://'+ server +'.infomous.com/site/economist/'+ config.version +'/';
    return {
        //css: base+'economist.css',
        embedjs: base+'client/embed.js?'
    };
})();

var _vars = _I.get_url_params( _ec_tag );
var _params = _I.get_url_params();

_I.esc(_vars);
_I.esc(_params);

for (var k in _vars_ec)
    _vars[k] = _vars_ec[k];

window.params = {
    allowFullScreen: true,
    allowScriptAccess: "always",
    wmode: "opaque",
    bgcolor: "#D9E4E6"
};

//go...

load_js_file( _ec_path.embedjs + hash2query(_vars), function(){} );

/* end of embed.js snippet sim */


/*
 * economist app
 */

function hash2query( hash ) {
    var query = '';
    for (var k in hash)
        query += k + '=' + hash[k] + '&';
    return query;
}

function get_full_cloud_url() {
    
    var trail = '/conversation-cloud';
    var href = window.location.href;

    if ( /economist\.com/.test(href) )
        return trail;
    
    var arr = href.split('/');
    if ( ! /\./.test( arr[arr.length-1] ) ) //url is not a file
        return href + trail; 
    
    return arr.slice(0,-1).join('/') + trail;
}

function is_full_version() {
    return cloud_width > 450;
}

function set_logo(url, title) {
    var bld = _vars.brandLogoDestination;
    url = bld !== undefined ? decodeURIComponent(bld) : url;
    proxy.set_var('brandLogoDestination', url);
    proxy.set_var('brandLogoText', title);
}

function init() { 

    var sections = (function() {

        var _curr = undefined;
        
        var _list = {

            readerscomments: {
                
                ga_event: 'Readerscomments',
                title: 'Readers\' comments',
                
                update: function( daysback ) {

                    set_logo('http://www.infomous.com/site/economist', 'Powered by Infomous and Appinions');
                    
                    proxy.set_var('type', 'jodange');
                    //colors
                    proxy.set_vars( this.colors );
                    //del aggregator
                    proxy.set_vars({
                        agg: undefined,
                        sinceLast: undefined,
                        feeds: 'undefined'
                    });
                    //set appinions
                    proxy.set_vars({
                        fromDaysBack: daysback,
                        toDaysBack: 0,
                        'query:numOpinions': '2500',
                        'query:licensee': 'jodange',
                        'query:campaign': 'noAds',
                        'query:blocked': 'Polish,Russian,American,European,Libyan,French,Indian,Chinese,German,Turkish,Japanese,British,Nepali,Canadian'
                    });
                    //req
                    proxy.make_request();
                },

                colors: { 
                    colWord: '0x000000',
                    colWordHover: '0xFFFFFF',
                    colWordFade: '0x333333',
                    colWordHoverLinked: '0x000000',
                    colBackground: '0xD9E4E6',
                    colHoverBox: '0x08526D',
                    colFocusBox: '0xFFFFFF',
                    colFocusBorder: '0x08526D',
                    colBlob: '0xFFFFFF',
                    colBlobHover: '0x96AFAE',
                    colBlobBorder: '0x86A1A8',
                    colLink: '0x86A1A8',
                    colLinkHover: '0xFF0000',
                    colSourcesFill: '0xFFFFFF',
                    colSourcesLine1: '0x08526D',
                    colSourcesLine2: '0x08526D',
                    colSourcesTextHover: '0x488CA7',
                    colSourcesBorder: '0x488CA7'                    
                }
            },

            electionism: {
                
                ga_event: 'Election2012',
                title: 'Election 2012 tweets',

                update: function( daysback ) {

                    set_logo('http://www.infomous.com/site/economist/electionism.html', 'Powered by Infomous');

                    proxy.set_var('type', 'rss');
                    //colors
                    proxy.set_vars( this.colors );
                    //del appinions
                    proxy.set_vars({
                        fromDaysBack: undefined,
                        toDaysBack: undefined
                    });
                    //set aggregator
                    proxy.set_vars({
                        agg: 'yes',
                        sinceLast: daysback+'d',
                        'query:num': '2500',
                        'query:campaign' : 'electionism',
                        feeds: 'http://api.twitter.com/1/lists/statuses.atom?slug=latest-from-twitter&owner_screen_name=Electionism&per_page=100&include_entities=true&infcutbef=:%20'
                    });
                    //req
                    proxy.make_request();
                },

                colors: {
                    colBackground: '0xD9E4E6',
                    colHoverBox: '0xBF0A30',
                    colFocusBox: '0xFFFFFF',
                    colSourcesFill: '0xFFFFFF',
                    colSourcesLine1: '0x08526D',
                    colSourcesLine2: '0x08526D',
                    colSourcesTextHover: '0x488CA7',
                    colSourcesBorder: '0x488CA7',                            
                    colWordHighlighted: '0x005BED',
                    colWord: '0x002868',
                    colWordHover: '0xFFFFFF',
                    colWordFade: '0xFFB0B0',
                    colWordHoverLinked: '0x005BED',
                    colFocusBorder: '0x005BED',
                    colLink: '0xFFE0E0',
                    colLinkHover: '0xDEF1FF',
                    colBlob: '0xFFFFFF',
                    colBlobBorder: '0xBF0A30',
                    colBlobHover: '0xAAAAAA'
                }
            },

            davos: {
                
                ga_event: 'Davos2013',
                title: 'Davos Tweets',

                update: function( daysback ) {

                    set_logo('http://www.infomous.com/site/economist/davos.html', 'Davos 2013 Cloud by Infomous');

                    proxy.set_var('type', 'rss');
                    //colors
                    proxy.set_vars( this.colors );
                    //del appinions
                    proxy.set_vars({
                        fromDaysBack: undefined,
                        toDaysBack: undefined
                    });
                    //set aggregator
                    proxy.set_vars({
                        agg: 'yes',
                        sinceLast: daysback+'d',
                        'query:num': '2500',
                        'query:campaign' : 'davos',
                        feeds: 'http://api.twitter.com/1/lists/statuses.atom?slug=davos&owner_screen_name=InfomousLists&per_page=100&include_entities=true'
                    });
                    //req
                    proxy.make_request();
                },

                colors: {
                    colBackground: '0xD9E4E6',
                    colHoverBox: '0xBF0A30',
                    colFocusBox: '0xFFFFFF',
                    colSourcesFill: '0xFFFFFF',
                    colSourcesLine1: '0x08526D',
                    colSourcesLine2: '0x08526D',
                    colSourcesTextHover: '0x488CA7',
                    colSourcesBorder: '0x488CA7',                            
                    colWordHighlighted: '0x005BED',
                    colWord: '0x002868',
                    colWordHover: '0xFFFFFF',
                    colWordFade: '0xFFB0B0',
                    colWordHoverLinked: '0x005BED',
                    colFocusBorder: '0x005BED',
                    colLink: '0xFFE0E0',
                    colLinkHover: '0xDEF1FF',
                    colBlob: '0xFFFFFF',
                    colBlobBorder: '0xBF0A30',
                    colBlobHover: '0xAAAAAA'
                }
            }

        };
        
        return {

            has: function( section ) {
                return _list[section] !== undefined;
            },

            curr: function( section ) { 
                if (section === undefined)
                    return _list[_curr];
                _curr = section;
            },

            curr_id: function() { return _curr; },

            make_el: function( id ) {
                if ( ! sections.has(id) )
                    return undefined;
                return $('<a id="' + id + '" href="javascript:void(0);"><span>' + _list[id].title + '</span></a>');
            }
        }
    })();

    var $container = $('#infomous-cloudContainer');
    var $sections_container = $('#infomous-cloudSections');
    var $periodbar = $('#infomous-cloudPeriodBar');
    var $periodbt = $('#cloud-period-bt');
    var $fullbt = $('#cloud-full-bt');
    var $dates = $periodbar.find('.date');
    //var $footer = $('#infomous-cloudFooter');
    //var $periodtxt = $periodbt.find('span');

    //var $sections = $sections_container.find('.section'); 
    var $sections = add_sections( 
            section2arr( get_tabs() ),
            $sections_container
        );

    $sections.click( function() {
        goto_section( $(this).attr('id') );
        ga.track_event({
            action: 'menu_tab',
            label: sections.curr().ga_event
        });
    });

    $dates.click( function() {
        goto_date( $(this).attr('id') );
    }); 
    
    $container.css( 'width', I.css.size(cloud_width) );
    
    $periodbar.hide();
    //$periodbar.css('left', ($periodbar.parent().width()/2 - $periodbar.width()/2) );

    $periodbt.click( toggle_periodbar );
    $periodbar.find('img').click( toggle_periodbar );

    update_period_text(); 

    goto_section( get_ini_tab() );

    function add_sections( arr, $container ) {

        var i, id, $el;
        for (i = 0; i < arr.length; i++) {
            id = arr[i];
            $el = sections.make_el( id );
            if ( !$el ) continue;
            $el.addClass('section');
            if ( i === 0 )
                $el.addClass('active');

            $container.append( $el ); 
        }

        return $container.find('.section');
    }

    function toggle_periodbar() {
        if ( $periodbar.is(':visible') )
            $periodbar.fadeOut(400, update_period_text );
        else
            $periodbar.fadeIn(400, update_period_text );
    }

    function update_period_text() {
        //if ( $periodbar.is(':visible') )
            //$periodtxt.text('Hide time span');
        //else
            //$periodtxt.text('Show time span');
    }

    function update_full_bt() {

        if ( is_full_version() ) {
            $fullbt.hide();
            return;
        }
        
        var _curr = sections.curr_id();
        var _url = get_full_cloud_url();

        $fullbt.click( function() {
            $(this).attr( 'href', _url+'?days=1&ec_ini_tab='+_curr+'&ec_tabs='+get_tabs() );
        });

        $fullbt.show();
    }

    function goto_section(id) {

        if ( ! sections.has(id) )
            return;

        var $el = $('#'+id);
        
        if ( !$el.length )
            return;

        sections.curr( id );
        
        $sections.removeClass('active');
        $el.addClass('active');

        //set default period:
        
        var def_daysback = 1;

        sections.curr().update( def_daysback );
        
        update_full_bt();

        $dates.removeClass('activeDate');
        $periodbar.find('#daysback_'+def_daysback).addClass('activeDate');

        ga.track_page( sections.curr().ga_event );
    };

    function goto_date(id) {

        var $el = $('#'+id);

        if ( !$el.length )
            return;

        var daysback = parseInt( id.split('_').pop() );
        
        sections.curr().update( daysback );

        update_full_bt();

        $dates.removeClass('activeDate');
        $el.addClass('activeDate');
    } 

    function get_ini_tab() {

        var key = 'ec_ini_tab';

        var checks = []
            .concat( section2arr( _params[key] ) )
            .concat( section2arr( _vars[key] ) )
            .concat( section2arr( get_tabs() ) );

        for (var i = 0; i < checks.length; i++)
            if ( _valid( checks[i] ) )
                return checks[i];

        return undefined;

        function _valid( _id ) {
            return ! I.is_empty(_id) && sections.has(_id);
        } 
    } 

    function get_tabs() {

        var key = 'ec_tabs';

        var checks = [
            _params[key],
            _vars[key],
            'davos,electionism,readerscomments'
        ];

        for (var i = 0; i < checks.length; i++)
            if ( checks[i] )
                return checks[i];

        return undefined;
    }

    function section2arr( str ) {
        return I.is_str(str) ? str.split(',') : [];
    }
}

})(window);
>>>>>>> .r62175
