/*!
 * Infomous Cloud Toolbar
 * http://www.infomous.com/
 * 
 * @constructor
 * @param {Object} config
 */
(function(a){var b=function(G){G=G||{};a.esc(G);a.events(this);var i=G.id||"cloud_toolbar_"+new Date().getTime();this.id=function(){return i};var k=a.$;var u=this;var l={groups:true,sliders:{maxWords:{value:40,text:"Words",id:"maxWords",send_events:{change:true,slide:false},opt:{min:1,max:100,step:1}},zoom:{value:0.9,text:"Zoom",id:"zoom",send_events:{change:true,slide:false},opt:{min:1,max:4,step:0.1}},fontScale:{value:1.1,text:"Font Size",id:"fontScale",send_events:{change:true,slide:false},opt:{min:0.1,max:5,step:0.1}},curr_id:"",curr:function(){return this[this.curr_id]},foreach:function(K){var J,L;for(J in this){L=this[J];if(L===undefined||L.value===undefined){continue}K.call(L,J,L)}}}};var s={hidden:{button_text:"Hidden Words",add_button_text:"Hide Term",dialog_title:"Add Hidden Term",default_text:"Please enter a word to hide..."},focused:{button_text:"Focused Words",add_button_text:"Focus Term",dialog_title:"Add Focused Term",default_text:"Please enter a word to focus on..."}};var I=k("<div/>",{"class":"cloud-toolbar"});var y={has:function(J){return this[J]!==undefined}};G.has=function(J){return this.controls===undefined||this.controls.toLowerCase().indexOf(J.toLowerCase())!=-1};if(!G.has("font")){delete l.sliders.fontScale}if(!G.has("zoom")){delete l.sliders.zoom}if(!G.has("words")){delete l.sliders.maxWords}l.sliders.curr_id=(function(){var K,J=0;l.sliders.foreach(function(L,M){if(J++==0){K=M.id}});return K})();if(G.has("slider")){y.sliders=t(I);y.sliders_widget=D(I,y.sliders)}if(G.has("dict")){y.dict=x(I)}if(G.has("focus")){y.focused=p(I,"focused")}y.hidden=p(I,"hidden");if(G.has("groups")){y.groups=m(I)}if(y.has("sliders")){l.sliders.foreach(function(J,K){v(K.id,K.value)});y.sliders.get_selected_item().click()}this.update_dict=function(J){o(J)};this.update_focused=function(J){w("focused",J)};this.update_hidden=function(J){w("hidden",J)};this.update_groups=function(J){f(J)};this.update_maxWords=function(J){q("maxWords",J)};this.update_zoom=function(J){q("zoom",J)};this.update_fontScale=function(J){q("fontScale",J)};this.plug=function(J){u.on(["hidden","focused","dict","groups","maxWords","zoom","fontScale"],function(K){var L=J.get_var(K.key)!==K.value;J.set_var(K.key,K.value);if(L){J.make_request()}});u.on(["maxWords:init","zoom:init","fontScale:init"],function(K){J.set_var(K.key,K.value)});J.on(["hidden","focused","dict","groups","maxWords","zoom","fontScale"],function(K){u["update_"+K.key](K.value)})};this.add_to_dom=function(J){I.appendTo(J);I.css("width",K(G.width||"auto"));var L=I.find(".ctrls-widget");k(document).ready(function(){setTimeout(function(){L.each(function(M,N){var O=k(N);O.show();(O.position().top>0.1?O.hide():O.show())})},100)});function K(N){var O=parseInt(N);return isNaN(O)?"auto":O+M(N);function M(P){return !a.is_str(P)?"px":(P.indexOf("px")!=-1?"px":(P.indexOf("%")!=-1?"%":""))}}};this.$el=function(){return I};this.close_all_menues=function(){k.each(y,function(J,K){if(K.get_list!==undefined){K.get_list().hide()}})};this.update_focused("");this.update_hidden("");function B(K,J){w(K,J);u.dispatch(K,{key:K,value:J})}function d(J){u.dispatch("dict",{key:"dict",value:J})}function z(J){u.dispatch("groups",{key:"groups",value:J})}function F(K,J){u.dispatch(K,{key:K,value:J})}function v(K,J){q(K,J);u.dispatch(K+":init",{key:K,value:J})}function p(L,Q){var N="ctrls-"+Q,K=N+"-bt",J=N+"-list";var O=k("<div/>",{"class":N+" ctrls-widget"}),M=k("<button/>",{"class":K}),P=k("<div/>",{"class":J});M.text(s[Q].button_text);O.get_list=function(){return P};n(L,O,P,M);return O}function w(P,O){if(!y.has(P)){return}var N="ctrls-"+P+"-list-item",M=y[P].get_list();M.empty();var L=C(M,P);var J=O?O.split(","):[];k.each(J,function(Q,R){M.append('<div><button class="'+N+'">'+R+"</button></div>")});var K=M.find("."+N);K.button({icons:{secondary:"ui-icon-close"}});K.unbind("click");K.click(function(R){R.preventDefault();var Q=k(this).text();j.call(u,Q,P)});e(L);e(K)}function c(N){var M="",L=y[N].get_list(),K="ctrls-"+N+"-list-item",J=L.find("."+K);J.each(function(O,P){M+=k(P).text()+","});return M.slice(0,M.length-1)}function C(J,O){var K="ctrls-"+O+"-add-bt",M="ctrls-word-add-bt";var L=k('<button class="'+M+'"/>');J.remove("."+K);J.append(k('<div class="'+K+'"/>').append(L));var N=s[O].add_button_text;L.text(N);L.button({icons:{secondary:"ui-icon-plus"}});L.unbind("click");L.click(function(P){P.preventDefault();h(O,function(Q){H(Q,O,g)})});return L}function g(K,M){var L=c(M);var J=a.is_empty(L)?[]:L.split(",");J.push(K);var L=J.join();B.call(u,M,L)}function j(K,M){var J=c(M).split(",");a.remove(J,K);var L=J.join();B.call(u,M,L)}function h(Q,P){var M="ctrls-"+Q+"-add-dialog",K="ctrls-dialog ctrls-word-add-dialog",O=M+"-input",N=K+"-input",L=k("<div/>",{id:M,"class":K,title:s[Q].dialog_title}),J=k("<input/>",{type:"text",id:O,"class":N});k("#"+M).remove();L.append(J);k("body").append(L);L.dialog({width:310,buttons:[{text:"Add",click:function(R){R.preventDefault();P.call(this,R)}},{text:"Cancel",click:function(R){R.preventDefault();L.remove()}}]});J.unbind("keydown");J.keydown(P);J.attr("size",50);J.focus()}function H(N,P,O){if(!A(N)){return}var L=k("#ctrls-"+P+"-add-dialog");var J=L.find("#ctrls-"+P+"-add-dialog-input");var M=escape(k(J).val());var K=s[P].default_text;if(a.is_empty(M)||M==K){k(J).val(K);return}O.call(u,M,P);L.remove()}function t(J){var K="ctrls-sliders",S=K+"-bt",L=K+"-list",P=K+"-list-item",Q="_"+new Date().getTime();var R=k("<div/>",{id:K+Q,"class":K+" ctrls-widget"}),T=k("<button/>",{id:S+Q,"class":S}),O=k("<div/>",{id:L+Q,"class":L});var M,U;l.sliders.foreach(function(V,W){M=W.id;U=P+"-"+M+Q;O.append('<div><input type="radio" id="'+U+'" name="'+L+'" value="'+M+'" checked=""><label for="'+U+'" class="'+P+'">'+W.text+"</label></div>")});R.get_list=function(){return O};R.get_bt=function(){return T};R.get_items=function(){return O.find('input[name="'+L+'"]')};R.get_selected_item=function(){return O.find('input[value="'+l.sliders.curr_id+'"]')};n(J,R,O,T);var N=O.find('label[class="'+P+'"]');e(N);return R}function D(R,W){var Z=W.get_list(),aa=W.get_bt(),T=W.get_items();var ac="ctrls-slider",L=ac+"-value",S=ac+"-value-container",U=ac+"-widget",N="_"+new Date().getTime();var Q=k("<div/>",{id:ac+N,"class":ac+" ctrls-widget"}),ab=k("<div/>",{id:S+N,"class":S}),J=k("<p/>",{id:L+N,"class":L}),O=k("<div/>",{id:U+N,"class":U});Q.update=function(ad){J.text(ad);O.slider("value",ad)};ab.append(J);Q.append(ab);Q.append(O);R.append(Q);T.unbind("click");T.click(function(ad){ad.preventDefault();V.call(this)});T.button();var K=k.extend(true,{},l.sliders.curr().opt);K.value=l.sliders.curr().value;K.slide=X;K.change=P;O.slider(K);var M=O.slider("value");J.text(M);return Q;function V(){l.sliders.curr_id=k(this).attr("value");var ad=l.sliders.curr();J.text(ad.value);O.slider("option",ad.opt);O.slider("value",ad.value);aa.find(".ui-button-text").text(ad.text);Z.mouseleave()}function X(ae,ad){J.text(ad.value);l.sliders.curr().value=ad.value;Y("slide")}function P(ae,ad){if(!ae.originalEvent){return}Y("change")}function Y(ad){var ae=l.sliders.curr();if(ae.send_events[ad]===false){return}F(ae.id,ae.value)}}function q(M,K){if(!y.has("sliders")){return}var J=l.sliders[M],L=l.sliders.curr();if(M==L.id){y.sliders_widget.update(K)}J.value=K}function x(J){var K="ctrls-dict",S=K+"-bt",M=K+"-list",P=K+"-list-item";var L=k("<div/>",{"class":K+" ctrls-widget"}),U=k("<button/>",{"class":S}),Q=k("<div/>",{"class":M});U.text("Dictionaries");var T=["noun","verb","adjective","adverb","number","other"];var O,N,V;for(O=0;O<T.length;O++){N=T[O];V=P+"-"+N;Q.append('<div class="ui-widget"><input type="checkbox" id="'+V+'" title="'+N+'" checked="checked"><label for="'+V+'" class="'+P+'">'+N+"</label></div>")}L.get_list=function(){return Q};n(J,L,Q,U);var R=Q.find('input[type="checkbox"]');R.unbind("click");R.click(function(W){d(r())});return L}function r(){var K="";var J=y.dict.get_list().find('input[type="checkbox"]');J.each(function(O,P){var N=k(P);var M=N.attr("checked")?"1":"0";var L=N.attr("title");K+=L.toUpperCase()+"|"+M+","});return K.slice(0,K.length-1)}function o(O){if(!y.has("dict")){return}var N={};var J=O.split(",");var M=J.length;while(M--){var K=J[M].split("|");N[K[0].toLowerCase()]=a.bool(K[1])}var L=y.dict.get_list().find('input[type="checkbox"]');L.each(function(R,P){var S=k(P);var Q=S.attr("title").toLowerCase();S.attr("checked",N[Q])})}function m(L){var O="ctrls-groups",M=O+"-cb",K="Groups";var J=k("<div/>",{"class":O+" ctrls-widget ui-widget"});J.append('<input type="checkbox" id="'+M+'"><label for="'+M+'">'+K+"</label>");L.append(J);var N=J.find('input[type="checkbox"]');N.attr("checked",l.groups);N.unbind("click");N.click(function(P){z(N.is(":checked"))});return J}function f(J){if(!y.has("groups")){return}var K=y.groups.find('input[type="checkbox"]');K.attr("checked",J);l.groups=J}function n(J,L,O,K){var N="fast";L.addClass("ctrls-dropup");O.addClass("ctrls-dropup-list");K.addClass("ctrls-dropup-bt");M();K.unbind("click");K.click(function(R){R.preventDefault();(O.hidden?P():Q())});K.button({icons:{secondary:"ui-icon-triangle-1-s"}});O.unbind("mouseleave");O.mouseleave(Q);function M(){O.hide();O.hidden=true}function Q(){O.fadeOut(N);O.hidden=true}function P(){O.fadeIn(N);O.hidden=false}J.append(L);L.append(K);L.append(O)}function e(J){J.addClass("ctrls-dropup-list-item");E(J,"0px")}function E(K,J){K.css("border-top-left-radius",J);K.css("border-top-right-radius",J);K.css("border-bottom-left-radius",J);K.css("border-bottom-right-radius",J)}function A(J){if(J.type=="keydown"&&J.keyCode!="13"){return false}J.preventDefault();return true}};a.define("CloudToolbar",b)})(Infomous);